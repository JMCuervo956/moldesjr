<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabla de Verificación - Semana</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
  <%- include('partials/head') %>
  <style>
    .encabezado {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: #fff;
        z-index: 1000;
        padding: 15px 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .detalle-scroll {
        margin-top: 40px; /* Ajusta según el alto real del header */
        height: calc(100% - 120px);
        overflow-y: auto;
        padding: 20px;
        background-color: #f7f7f7;
      }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f7f9fc;
    color: #333;
    padding: 20px;
  }

    h3 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
        background: #fff;
    }
        
    /* Que las columnas Si, No, Na tengan un ancho fijo y igual */
    th, td {
    border: 1px solid #444;
    padding: 8px;
    vertical-align: top;
    }
    th {
      background-color: #f0f0f0;
      text-align: center;
    }
    td[colspan] {
      font-weight: bold;
      background-color: #e8e8e8;
      text-align: left;
    }

    td.center {
    width: 20px;       /* ancho fijo para columnas Si, No, Na */
    text-align: center;
    word-wrap: break-word; /* para que el texto largo se ajuste en varias líneas */
    white-space: normal;   /* permitir salto de línea dentro de la celda */
    }

  thead th {
    position: sticky;
    top: 0;
    background: #2980b9;
    color: white;
    padding: 12px 10px;
    font-weight: 600;
    text-align: center;
    border-bottom: 2px solid #21618c;
    white-space: normal;
    min-width: 40px;
  }
    /* Para que las filas crezcan en altura si hay contenido largo */
    td {
    white-space: normal; /* permitir salto de línea */
    }    

  thead tr:first-child th[colspan] {
    background: #3498db;
    font-size: 14px;
  }
  
  tbody tr:hover {
    background-color: #ecf6fd;
  }

  tbody td {
    padding: 10px 8px;
    vertical-align: top;
    white-space: normal;
    font-size: 14px;
    color: #444;
  }

  tbody td.center {
    text-align: center;
    width: 20px; /* igual ancho para Si, No, Na */
    word-break: break-word;
  }

  tbody tr td[colspan] {
    background: #f0f4f7;
    font-weight: 600;
    font-size: 16px;
  }

  .titulo-bloque {
    font-weight: 600;
    font-size: 16px;
    padding: 10px 15px;
  }

  table#tabla-verificacion tbody tr td.titulo-bloque {
    background-color: #cfcbcb !important;
  }

  </style>
</head>
<body>
      <header class="encabezado">
          <%- include('partials/navigationf') %>
      </header>
      <div class="d-flex justify-content-start align-items-center mb-0">
        <a href="/opciones" class="btn btn-success btn-sm btnind-hover-effect ms-2">Regresar</a>
      </div>
      <div class="detalle-scroll"></div>
                <div class="container-fluid mt-1">
                      <div class="d-flex justify-content-start align-items-center mb-3">
                        <a href="/opciones" class="btn btn-success btn-sm btnind-hover-effect ms-2">Regresar</a>
                      </div>
                      <div class="content2">
                        <div class="register-formAnchoCM">  

                        <h5>Verificación Semanal</h5>

                        <table id="tabla-verificacion">
                          
                          <thead>
                            <tr>
                              <th rowspan="2">No.</th>
                              <th rowspan="2">Aspectos a Verificar</th>
                              <% dias.forEach((dia, i) => { %>
                                <th colspan="3"><%= dia.nombre %> (<%= dia.fecha %>)</th>
                              <% }) %>
                            </tr>
                            <tr>
                              <% dias.forEach(() => { %>
                                <th>Si</th>
                                <th>No</th>
                                <th>Na</th>
                              <% }) %>
                            </tr>
                          </thead>

                      <tbody>
                        <% inspecc.forEach(bloque => { %>
                          <tr>
                            <td colspan="<%= 2 + dias.length * 3 %>" class="titulo-bloque"><%= bloque.titulo %></td>
                          </tr>
                          <% bloque.items.forEach(function(item) { %>
                            <tr>
                              <td><%= item.no %></td>
                              <td><%= item.aspecto %></td>
                              <% dias.forEach(function(dia) { 
                                  var val = item.valores[dia.fecha] || {};
                                  const tieneCheck = val.si || val.no_ || val.na;
                              %>
                                <% if (tieneCheck) { %>
                                  <td class="center"><%= val.si %></td>
                                  <td class="center"><%= val.no_ %></td>
                                  <td class="center"><%= val.na %></td>
                                <% } else { %>
                                  <td class="center" colspan="3" style="font-style: italic; color: gray;">
                                    <%= val.observacion || '' %>
                                  </td>
                                <% } %>
                              <% }) %>
                            </tr>
                          <% }) %>
                        <% }) %>
                      </tbody>

                        </table>
                    </div>
                  </div>
                </div>
      </div>

<%- include('partials/footer') %>

  </body>
</html>
