<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <title>Asamblea</title>
    <%- include('partials/head') %>
    <style>
        th {
            border: 1px solid rgb(247, 244, 244);
            padding: 8px;
            text-align: left;
        }
        .successImage {
            display: none; /* Ocultar inicialmente */
            width: 50px; /* Ajusta el tamaño según necesites */
            margin-top: 10px; /* Espacio superior */
        }
    </style>
</head>

<body>
    <%- include('partials/navigation') %>  
    <h5 style="font-size: 14px; color: blue; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); transition: color 0.3s ease;" 
        onmouseover="this.style.color='darkblue';" 
        onmouseout="this.style.color='blue';">
        <span style="padding-left: 10px;"><%= name %></span>
    </h5>
    <br>
    <div class="content">
        <div class="register-formAncho">
            <div class="container mt-1">
                <table class="table table-bordered table-hover">
                    <thead>
                        <th>
                            <h4>Preguntas</h4>
                            <a href="/menuprc" class="btn btn-success btn-sm btnind-hover-effect">Regresar</a>
                            <a href="/preguntas" class="btn btn-primary btn-sm btnind-hover-effect">Adicionar</a>
                        </th>
                    </thead>        
                </table>
            </div>

            <div class="container mt-1">
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr style="font-size: 8px; text-align: center;">
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Opciones<br>de Respuesta</th>
                            <th></th>
                            <th style="font-size: 8px; text-align: center;">Activo<br>"1" No Disponible</th>
                        </tr>                        
                    </thead>
                    <tbody>
                            <% if (data && data.length > 0) { %>
                                <% data.forEach(function(item) { %>
                                    <tr id="item-<%= item.id %>">
                                        <td>
                                            <%= item.texto %>
                                        </td>
                                        
                                        <!-- Botón Modificar -->
                                        <td>
                                            <a href="/modificar?id=<%= item.id %>&texto=<%= item.texto %>" class="btn btn-warning btn-sm btn-hover-effect <%= item.activo === 1 ? 'disabled' : '' %>">
                                                Mod
                                            </a>
                                        </td>
                        
                                        <!-- Botón Eliminar -->
                                        <td>
                                            <a href="/eliminar?id=<%= item.id %>&texto=<%= item.texto %>" class="btn btn-danger btn-sm btn-hover-effect <%= item.activo === 1 ? 'disabled' : '' %>">
                                                Ret
                                            </a>
                                        </td>
                        
                                        <!-- Botón Opciones -->
                                        <td>
                                            <a href="/opciones?id=<%= item.id %>&texto=<%= item.texto %>" class="btn btn-primary btn-sm btn-hover-effect <%= item.activo === 1 ? 'disabled' : '' %>">
                                                Opc
                                            </a>
                                        </td>
                        
                                        <!-- Estado (sin cambios) -->
                                        <td>
                                            <button class="btn btn-link btn-sm btn-hover-effect toggle-estado" data-id="<%= item.id %>" data-estado="<%= item.activo %>">
                                                <%= item.activo === 1 ? 'Desactivar' : 'Activar' %>
                                            </button>
                                        </td>
                                        <td class="tex-hover-effect" 
                                        style="text-align: center; color: <%= item.activo.toString() === '1' ? 'red' : 'black' %>;">
                                        <%= item.activo %>
                                    </td>
                                

                                <% }); %>
                            <% } else { %> 
                                <tr>
                                    <td colspan="5">No hay datos disponibles</td>   
                                </tr>
                            <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Manejar el cambio de estado (activo/inactivo)
            $('.toggle-estado').click(function() {
                const id = $(this).data('id');
                const estadoActual = $(this).data('estado');
                const nuevoEstado = estadoActual === 1 ? 0 : 1; // Alternar entre 1 y 0
                
                // Realizar la solicitud AJAX
                $.ajax({
                    url: '/activar', // La URL de tu servidor para actualizar el estado
                    method: 'POST',
                    data: {
                        id: id,
                        estado: nuevoEstado
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            // Actualizar la interfaz después de la respuesta exitosa
                            const fila = $('#item-' + id);
                            fila.find('td:last').html(nuevoEstado);
                            fila.find('.toggle-estado').text(nuevoEstado === 1 ? 'Desactivar' : 'Activar');
                            fila.find('td:last').css('color', nuevoEstado === 1 ? 'red' : 'black');
                            fila.find('.toggle-estado').data('estado', nuevoEstado);

                            // Actualizar el estado de los botones
                            if (nuevoEstado === 1) {
                                fila.find('a').addClass('disabled');
                            } else {
                                fila.find('a').removeClass('disabled');
                            }

                            // Cambiar el color de la celda del estado también
                            fila.find('td:last').css('color', nuevoEstado === 1 ? 'red' : 'black');
                        } else {
                            alert('Error al actualizar el estado');
                        }
                    },
                    error: function() {
                        alert('Hubo un problema con la solicitud');
                    }
                });
            });
        });
    </script>
</body>
</html>
